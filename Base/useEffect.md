2023-09-25 21:48
Tags: #web #react #draft
## –î–ª—è —á–µ–≥–æ

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å `–≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π`. –ó–¥–µ—Å—å –ø–æ–¥ `–≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π` –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –ª—é–±–æ–π –∫—É—Å–æ–∫ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è React:
1. –¢–∞–π–º–µ—Ä, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π `setInterval()` –∏ `clearInterval()`;
2. –°–æ–±—ã—Ç–∏–µ, –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º–æ–µ —Å –ø–æ–º–æ—â—å—é `window.addEventListener()` –∏ `window.removeEventListener()`;
3. –°—Ç–æ—Ä–æ–Ω–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–π —Å –ø–æ—Ö–æ–∂–∏–º API `animation.start()` –∏ `animation.reset()`.  

```js
useEffect(() => {
    calculateSalary(income);
  }, [income]);
```

---
### useEffect(setup, dependencies?)
### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

`setup` - —Ñ—É–Ω–∫—Ü–∏—è, —Å –ª–æ–≥–∏–∫–æ–π `–≠—Ñ—Ñ–µ–∫—Ç–∞`. –û–Ω–∞ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `cleanup`. –ö–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ `DOM`, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `setup` –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º–∏ `dependencies`, React —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `cleanup` (–µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞) —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º `setup` —Å –Ω–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª–∏—Ç—Å—è –∏–∑ `DOM`, React –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `cleanup`.

–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ `dependencies` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, —É–ø–æ–º—è–Ω—É—Ç—ã—Ö –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `setup`. –≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—Å—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–ª–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ú–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –∏–º–µ—Ç—å –≤–∏–¥ `[dep1, dep2, dep3]`. React —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø—Ä–∏ –ø–æ–º–æ—â–∏ `Object.is`. –ï—Å–ª–∏ –æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, —Ç–æ `setup` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–∑ `dependencies`. –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, —Ç–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
### –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

–•—É–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç undefined.
### –ü—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è

–ö–∞–∫ –∏ –ª—é–±–æ–π —Ö—É–∫ –µ–≥–æ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–ª–∏ –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ö—É–∫–∞—Ö. –ù–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ –∏–ª–∏ –≤ —É—Å–ª–æ–≤–∏—è—Ö.

–ò–Ω–æ–≥–¥–∞ useEffect –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω—É–∂–µ–Ω TODO: https://react.dev/learn/you-might-not-need-an-effect

–ö–æ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º, —Ç–æ React –≤—ã–∑–æ–≤–µ—Ç –æ–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª `setup + cleanup` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ `setup`. –≠—Ç–æ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ `cleanup` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç—É, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `setup`.

–ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è, —Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã, –æ—Ç —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏–∑–±–∏–≤–∞—Ç—å—Å—è. (–†–∞–∑–¥–µ–ª `"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"`).

TODO: –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–ª–∏—á–∏–µ –æ—Ç useLayoutEffect https://react.dev/reference/react/useLayoutEffect

---
## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ó–¥–µ—Å—å `useEffect` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è. –ê —Ç–∞–∫ –∂–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.

```js
function App() {
  useEffect(() => {
  	document.addEventListener('click', handleClick);

	return () => document.removeEventListener('click', handleClick);
  }, []);
}
```

–í–æ–æ–±—â–µ React –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `setup` –∏ `cleanup`, –∫–æ–≥–¥–∞ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.
1. –ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `setup` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è);
2. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –≥–¥–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã:
	- –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `cleanup` —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –ø—Ä–æ–ø—Å–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º;
	- –î–∞–ª–µ–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `setup` —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–æ–ø—Å–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.
3. –ü–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `cleanup` –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª—è–µ—Ç –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ö—É–∫–µ

–í —Ö—É–∫–µ `useChatRoom` —Å–æ–∫—Ä—ã—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ. 

```js
export function useChatRoom({ serverUrl, roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId, serverUrl]);
}
```
### Fetching –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞

–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ `useEffect`.

TODO: –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect

```js
export default function Page() {
  const [person, setPerson] = useState('Alice');
  const [bio, setBio] = useState(null);

  useEffect(() => {
    let ignore = false;
    
    setBio(null);
    
    fetch(person)
	    .then(result => {
	      if (!ignore) {
	        setBio(result);
	      }
	    });
    
    return () => {
      ignore = true;
    };
  }, [person]);
```
### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–∏ –≤ useEffect

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ.

```js
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const intervalId = setInterval(() => {
      setCount(count + 1); // You want to increment the counter every second...
    }, 1000)
    return () => clearInterval(intervalId);
  }, [count]); // üö© ... but specifying `count` as a dependency always resets the interval.
  // ...
}```

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫.

```js
import { useState, useEffect } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const intervalId = setInterval(() => {
      setCount(c => c + 1); // ‚úÖ Pass a state updater
    }, 1000);
    return () => clearInterval(intervalId);
  }, []); // ‚úÖ Now count is not a dependency

  return <h1>{count}</h1>;
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–∫—Ç–∞

TODO: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å useRef, —ç—Ç–æ –±—ã–≤–∞–µ—Ç –ø–æ–ª–µ–∑–Ω–æ.